import{a as C,t as L,d as se}from"../chunks/disclose-version.rcRw2RAa.js";import{P as qe,S as Ge,aq as Te,R as J,F as le,G as ze,x as Ye,N as Le,a6 as Ke,a7 as he,E as ce,I as Q,a4 as Ue,Q as $e,a5 as Xe,ar as de,aa as Qe,z as we,as as pe,at as Se,au as me,av as We,m as Ze,_ as xe,aw as je,M as et,ax as tt,U as at,B as nt,J as rt,ay as ot,C as it,a3 as ye,az as st,aA as lt,aB as ct,aC as dt,a9 as vt,p as re,i as oe,s as A,j as g,aD as ee,k as u,t as z,o as ie,g as _,ap as _e,h as Je,a as ut}from"../chunks/runtime.DXVpjAUZ.js";import{p as K,b as ge,i as W,o as ft}from"../chunks/index-client.-2ZAsmd_.js";import{d as be,s as ae}from"../chunks/render.CVg5iJup.js";import{i as _t}from"../chunks/lifecycle.DED4nl6c.js";import{b as P}from"../chunks/paths.Ai5WKSSd.js";let ve=null;function Me(e,t){return t}function gt(e,t,a,r){for(var n=[],o=t.length,s=0;s<o;s++)je(t[s].e,n,!0);var S=o>0&&n.length===0&&a!==null;if(S){var k=a.parentNode;et(k),k.append(a),r.clear(),V(e,t[0].prev,t[o-1].next)}tt(n,()=>{for(var x=0;x<o;x++){var f=t[x];S||(r.delete(f.k),V(e,f.prev,f.next)),at(f.e,!S)}})}function He(e,t,a,r,n,o=null){var s=e,S={flags:t,items:new Map,first:null},k=(t&Te)!==0;if(k){var x=e;s=J?le(nt(x)):x.appendChild(qe())}J&&ze();var f=null,l=!1;Ge(()=>{var p=a(),d=Ye(p)?p:p==null?[]:Le(p),c=d.length;if(l&&c===0)return;l=c===0;let h=!1;if(J){var b=s.data===Ke;b!==(c===0)&&(s=he(),le(s),ce(!1),h=!0)}if(J){for(var w=null,E,i=0;i<c;i++){if(Q.nodeType===8&&Q.data===rt){s=Q,h=!0,ce(!1);break}var m=d[i],B=r(m,i);E=Fe(Q,S,w,null,m,B,i,n,t),S.items.set(B,E),w=E}c>0&&le(he())}J||pt(d,S,s,n,t,r),o!==null&&(c===0?f?Ue(f):f=$e(()=>o(s)):f!==null&&Xe(f,()=>{f=null})),h&&ce(!0),a()}),J&&(s=Q)}function pt(e,t,a,r,n,o){var F,$,G,H;var s=(n&ot)!==0,S=(n&(pe|me))!==0,k=e.length,x=t.items,f=t.first,l=f,p,d=null,c,h=[],b=[],w,E,i,m;if(s)for(m=0;m<k;m+=1)w=e[m],E=o(w,m),i=x.get(E),i!==void 0&&((F=i.a)==null||F.measure(),(c??(c=new Set)).add(i));for(m=0;m<k;m+=1){if(w=e[m],E=o(w,m),i=x.get(E),i===void 0){var B=l?l.e.nodes_start:a;d=Fe(B,t,d,d===null?t.first:d.next,w,E,m,r,n),x.set(E,d),h=[],b=[],l=d.next;continue}if(S&&mt(i,w,m,n),i.e.f&de&&(Ue(i.e),s&&(($=i.a)==null||$.unfix(),(c??(c=new Set)).delete(i))),i!==l){if(p!==void 0&&p.has(i)){if(h.length<b.length){var q=b[0],T;d=q.prev;var te=h[0],y=h[h.length-1];for(T=0;T<h.length;T+=1)ke(h[T],q,a);for(T=0;T<b.length;T+=1)p.delete(b[T]);V(t,te.prev,y.next),V(t,d,te),V(t,y,q),l=q,d=y,m-=1,h=[],b=[]}else p.delete(i),ke(i,l,a),V(t,i.prev,i.next),V(t,i,d===null?t.first:d.next),V(t,d,i),d=i;continue}for(h=[],b=[];l!==null&&l.k!==E;)l.e.f&de||(p??(p=new Set)).add(l),b.push(l),l=l.next;if(l===null)continue;i=l}h.push(i),d=i,l=i.next}if(l!==null||p!==void 0){for(var v=p===void 0?[]:Le(p);l!==null;)l.e.f&de||v.push(l),l=l.next;var R=v.length;if(R>0){var U=n&Te&&k===0?a:null;if(s){for(m=0;m<R;m+=1)(G=v[m].a)==null||G.measure();for(m=0;m<R;m+=1)(H=v[m].a)==null||H.fix()}gt(t,v,U,x)}}s&&Qe(()=>{var Y;if(c!==void 0)for(i of c)(Y=i.a)==null||Y.apply()}),we.first=t.first&&t.first.e,we.last=d&&d.e}function mt(e,t,a,r){r&pe&&Se(e.v,t),r&me?Se(e.i,a):e.i=a}function Fe(e,t,a,r,n,o,s,S,k){var x=ve;try{var f=(k&pe)!==0,l=(k&We)===0,p=f?l?Ze(n):xe(n):n,d=k&me?xe(s):s,c={i:d,v:p,k:o,a:null,e:null,prev:a,next:r};return ve=c,c.e=$e(()=>S(e,p,d),J),c.e.prev=a&&a.e,c.e.next=r&&r.e,a===null?t.first=c:(a.next=c,a.e.next=c.e),r!==null&&(r.prev=c,r.e.prev=c.e),c}finally{ve=x}}function ke(e,t,a){for(var r=e.next?e.next.e.nodes_start:a,n=t?t.e.nodes_start:a,o=e.e.nodes_start;o!==r;){var s=it(o);n.before(o),o=s}}function V(e,t,a){t===null?e.first=a:(t.next=a,t.e.next=a&&a.e),a!==null&&(a.prev=t,a.e.prev=t&&t.e)}let Ee=!1;function Ve(){Ee||(Ee=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{var t;if(!e.defaultPrevented)for(const a of e.target.elements)(t=a.__on_r)==null||t.call(a)})},{capture:!0}))}function Z(e){if(J){var t=!1,a=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var r=e.value;M(e,"value",null),e.value=r}if(e.hasAttribute("checked")){var n=e.checked;M(e,"checked",null),e.checked=n}}};e.__on_r=a,lt(a),Ve()}}function M(e,t,a,r){var n=e.__attributes??(e.__attributes={});J&&(n[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||n[t]!==(n[t]=a)&&(t==="style"&&"__styles"in e&&(e.__styles={}),t==="loading"&&(e[ct]=a),a==null?e.removeAttribute(t):typeof a!="string"&&bt(e).includes(t)?e[t]=a:e.setAttribute(t,a))}var Ne=new Map;function bt(e){var t=Ne.get(e.nodeName);if(t)return t;Ne.set(e.nodeName,t=[]);for(var a,r=ye(e),n=Element.prototype;n!==r;){a=st(r);for(var o in a)a[o].set&&t.push(o);r=ye(r)}return t}function ne(e,t,a){if(a){if(e.classList.contains(t))return;e.classList.add(t)}else{if(!e.classList.contains(t))return;e.classList.remove(t)}}function ht(e,t,a,r=a){e.addEventListener(t,a);const n=e.__on_r;n?e.__on_r=()=>{n(),r()}:e.__on_r=r,Ve()}function j(e,t,a=t){var r=dt();ht(e,"input",()=>{var n=Ie(e)?Ae(e.value):e.value;a(n),r&&n!==(n=t())&&(e.value=n??"")}),vt(()=>{var n=t();if(J&&e.defaultValue!==e.value){a(e.value);return}Ie(e)&&n===Ae(e.value)||e.type==="date"&&!n&&!e.value||n!==e.value&&(e.value=n??"")})}function Ie(e){var t=e.type;return t==="number"||t==="range"}function Ae(e){return e===""?null:+e}const I=[];for(let e=0;e<256;++e)I.push((e+256).toString(16).slice(1));function wt(e,t=0){return(I[e[t+0]]+I[e[t+1]]+I[e[t+2]]+I[e[t+3]]+"-"+I[e[t+4]]+I[e[t+5]]+"-"+I[e[t+6]]+I[e[t+7]]+"-"+I[e[t+8]]+I[e[t+9]]+"-"+I[e[t+10]]+I[e[t+11]]+I[e[t+12]]+I[e[t+13]]+I[e[t+14]]+I[e[t+15]]).toLowerCase()}let ue;const St=new Uint8Array(16);function xt(){if(!ue){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ue=crypto.getRandomValues.bind(crypto)}return ue(St)}const yt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Re={randomUUID:yt};function kt(e,t,a){if(Re.randomUUID&&!t&&!e)return Re.randomUUID();e=e||{};const r=e.random||(e.rng||xt)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,wt(r)}const Et=e=>{localStorage.setItem("scene",JSON.stringify(e)),console.log("Data saved to localStorage")},Nt=()=>{const e=localStorage.getItem("scene");if(e){const t=JSON.parse(e);return console.log("scene loaded from localStorage"),t}return console.log("no scene found in localStorage"),null};let O=K({name:"name of scene",combatants:[]});const De=()=>({id:kt(),name:"",initiative:0}),Pe=e=>{console.log(`Load scene ${JSON.stringify(e)}`),Object.assign(O,e)},It=()=>{Et(O)},Be=()=>{O.combatants.sort((e,t)=>e.initiative-t.initiative)},fe=".splimo.json",At=e=>new Promise((t,a)=>{const r=new FileReader;r.onload=n=>{var o;try{const s=JSON.parse((o=n.target)==null?void 0:o.result);t(s)}catch(s){console.error("error parsing JSON:",s),alert("invalid JSON file"),a(s)}},r.onerror=n=>{console.error("error reading file:",n),a(n)},r.readAsText(e)}),Ce=(e,t)=>{const a=JSON.stringify(e,null,2),r="data:application/json;charset=utf-8,"+encodeURIComponent(a),n=document.createElement("a");n.href=r,n.download=t,n.target="_blank",n.click()},Rt=async(e,t="scene"+fe)=>{if(e){t.endsWith(fe)||(t+=fe);const a=[JSON.stringify(e,null,2)],r=new File(a,t,{type:"application/json",lastModified:Date.now()});if(navigator.canShare&&navigator.canShare({files:[r]}))try{await navigator.share({files:[r],title:"Download JSON",text:"Download JSON file"})}catch(n){console.error("Error sharing JSON:",n),console.info("Try downloading file via data url fallback"),Ce(e,t)}else Ce(e,t)}else alert("No data to download")};var Dt=(e,t)=>t(),Ct=(e,t)=>t(),Ot=L('<div class="navbar bg-base-100"><div class="flex-1"><a class="btn btn-ghost text-xl">Splittermond Tickleiste</a></div> <div class="flex-none space-x-2"><label for="battleScene" class="btn"><img width="30em" alt="download"> Upload Scene</label> <input type="file" id="battleScene" name="battleScene" accept="application/json" class="battle-scene-file-input file-input w-full max-w-xs svelte-ekzg43"> <button class="btn"><img width="30em" alt="download"> Download Scene</button> <button class="btn"><img width="30em" alt="download"></button></div></div>');function Tt(e,t){re(t,!1);const a=c=>{const h=c.target;if(h&&h.files){const b=h.files[0];b&&At(b).then(w=>{Pe(w)}),h.value=""}},r=()=>{let c=O.name.toLowerCase().trim().replace(/\s+/g,"_");Rt(O,c)},n=()=>{};_t();var o=Ot(),s=A(g(o),2),S=g(s),k=g(S);M(k,"src",`${P??""}/svg/upload-svgrepo-com.svg`),ee(),u(S);var x=A(S,2);x.__change=a;var f=A(x,2);f.__click=[Dt,r];var l=g(f);M(l,"src",`${P??""}/svg/download-svgrepo-com.svg`),ee(),u(f);var p=A(f,2);p.__click=[Ct,n];var d=g(p);M(d,"src",`${P??""}/svg/circle-question-svgrepo-com.svg`),u(p),u(s),u(o),C(e,o),oe()}be(["change","click"]);var Lt=(e,t,a)=>t(_(a)),Ut=L('<button class="btn svelte-2o3o2v"> </button>'),$t=(e,t)=>t(),Jt=L('<dialog id="tickSelectionModal" class="modal"><div class="modal-box"><form method="dialog"><button class="btn btn-circle btn-ghost btn-sm absolute right-2 top-2 svelte-2o3o2v">âœ•</button></form> <h3 class="mb-5 text-lg font-bold">Select ticks</h3> <div class="keypad svelte-2o3o2v"></div> <div><button class="btn svelte-2o3o2v"><img width="30em" alt="toggle negation"></button></div></div> <form method="dialog" class="modal-backdrop"><button class="svelte-2o3o2v">close</button></form></dialog>');function Mt(e,t){re(t,!0);let a,r;const n=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20];let o=_e(!1);function s(){return a.showModal(),new Promise(b=>{r=b})}function S(){a.close()}function k(b){S();let w=_(o)?-1:1;r(w*b)}function x(){ie(o,!_(o))}var f=Jt();ge(f,b=>a=b,()=>a);var l=g(f),p=A(g(l),4);He(p,21,()=>n,Me,(b,w)=>{var E=Ut();E.__click=[Lt,k,w];var i=g(E,!0);u(E),z(()=>ae(i,_(w))),C(b,E)}),u(p);var d=A(p,2),c=g(d);c.__click=[$t,x];var h=g(c);return M(h,"src",`${P??""}/svg/minus-svgrepo-com.svg`),u(c),u(d),u(l),ee(2),u(f),z(()=>ne(c,"btn-active",_(o))),C(e,f),oe({show:s})}be(["click"]);function Oe(e,t,a){e.key==="Enter"&&t(_(a))}function Ht(e,t,a){ie(t,K(a.Editing))}function Ft(e,t,a){ie(t,K(a.Running)),Be()}var Vt=L('<input type="text" placeholder="Scene name..." class="input input-bordered w-full max-w-xs">'),Pt=(e,t,a)=>t(_(a)),Bt=L('<tr><td><input type="text" placeholder="Name..." class="input input-bordered w-full max-w-xs"></td><td><input type="number" placeholder="Iniative..." class="input input-bordered w-full max-w-xs"></td><td><button class="btn"><img width="30em" alt="add"></button></td></tr>'),qt=(e,t,a)=>t(_(a)),Gt=L('<input type="text" class="input input-bordered w-full max-w-xs">'),zt=L('<input type="number" class="input input-bordered w-full max-w-xs">'),Yt=(e,t,a)=>t(_(a).id),Kt=L('<button class="btn"><img width="30em" alt="delete"></button>'),Xt=L("<tr><td><!></td><td><!></td><td><!></td></tr>"),Qt=L('<!> <div class="mx-48 mt-12 overflow-x-auto"><div class="navbar bg-base-100"><div class="flex-1"><!></div> <div class="flex-none space-x-2"><button class="btn"><img width="30em" alt="download"> Run Scene</button> <button class="btn"><img width="30em" alt="toggle edit"> Edit Scene</button></div></div> <table class="table"><thead><tr><th>Name</th><th>Initiative</th><th></th></tr></thead><tbody><!><!></tbody></table></div>',1);function Wt(e,t){re(t,!0);const a={Editing:"EDITING",Running:"RUNNING"};let r=_e(K(De())),n=_e(K(a.Editing)),o,s;function S(y){y.name!==""&&(O.combatants.push(y),ie(r,K(De())),o.focus(),o.select())}function k(y){O.combatants=O.combatants.filter(v=>v.id!==y)}function x(y){_(n)===a.Running&&s.show().then(v=>{y.initiative+=v,Be()})}var f=Qt(),l=Je(f);ge(Mt(l,{}),y=>s=y,()=>s);var p=A(l,2),d=g(p),c=g(d),h=g(c);W(h,()=>_(n)===a.Editing,y=>{var v=Vt();Z(v),j(v,()=>O.name,R=>O.name=R),C(y,v)},y=>{var v=se();z(()=>ae(v,O.name)),C(y,v)}),u(c);var b=A(c,2),w=g(b);w.__click=[Ft,n,a];var E=g(w);M(E,"src",`${P??""}/svg/circle-play-svgrepo-com.svg`),ee(),u(w);var i=A(w,2);i.__click=[Ht,n,a];var m=g(i);M(m,"src",`${P??""}/svg/pencil-svgrepo-com.svg`),ee(),u(i),u(b),u(d);var B=A(d,2),q=A(g(B)),T=g(q);W(T,()=>_(n)===a.Editing,y=>{var v=Bt(),R=g(v),U=g(R);ge(U,D=>o=D,()=>o),Z(U),U.__keydown=[Oe,S,r],u(R);var F=A(R),$=g(F);Z($),$.__keydown=[Oe,S,r],u(F);var G=A(F),H=g(G);H.__click=[Pt,S,r];var Y=g(H);M(Y,"src",`${P??""}/svg/plus-svgrepo-com.svg`),u(H),u(G),u(v),j(U,()=>_(r).name,D=>_(r).name=D),j($,()=>_(r).initiative,D=>_(r).initiative=D),C(y,v)});var te=A(T);He(te,17,()=>O.combatants,Me,(y,v)=>{var R=Xt();R.__click=[qt,x,v];var U=g(R),F=g(U);W(F,()=>_(n)===a.Editing,D=>{var N=Gt();Z(N),j(N,()=>_(v).name,X=>_(v).name=X),C(D,N)},D=>{var N=se();z(()=>ae(N,_(v).name)),C(D,N)}),u(U);var $=A(U),G=g($);W(G,()=>_(n)===a.Editing,D=>{var N=zt();Z(N),j(N,()=>_(v).initiative,X=>_(v).initiative=X),C(D,N)},D=>{var N=se();z(()=>ae(N,_(v).initiative)),C(D,N)}),u($);var H=A($),Y=g(H);W(Y,()=>_(n)===a.Editing,D=>{var N=Kt();N.__click=[Yt,k,v];var X=g(N);M(X,"src",`${P??""}/svg/trash-svgrepo-com.svg`),u(N),C(D,N)}),u(H),u(R),z(()=>ne(R,"hover",_(n)===a.Running)),C(y,R)}),u(q),u(B),u(p),z(()=>{ne(w,"btn-active",_(n)===a.Running),ne(i,"btn-active",_(n)===a.Editing)}),C(e,f),oe()}be(["click","keydown"]);var Zt=L("<!> <!>",1);function oa(e,t){re(t,!0),ft(()=>{const o=Nt();o&&Pe(o)}),ut(()=>{It()});var a=Zt(),r=Je(a);Tt(r,{});var n=A(r,2);Wt(n,{}),C(e,a),oe()}export{oa as component};
